---
layout: page
title: Stage 2 - Web Client
---

## Prerequisites

Stage 2 tutorial requires you finished [Stage 1 tutorial](/tutorial/01-lncli). You'll need a total of 6 terminal windows:

1. one terminal to launch `btcd` node;
2. three terminals to launch a `lnd` node for each peer (i.e. Alice, Bob and Charlie);
3. one terminal to submit commands to the `btcd` node and to the three `lnd` nodes via `btcctl` and `lncli`;
4. one terminal to launch the `lncli-web` app.

## Introduction

In this tutorial you will learn how to set up and interact with `lnd` using a
[web client](https://github.com/mably/lncli-web) built by [Francois
Mably](https://github.com/mably). Setup instructions are courtesy of the
creator himself. Before beginning this step make sure you have `node` and `npm`
installed. The advice is to install them by using [Node Version Manager](https://github.com/creationix/nvm#installation).

### Setting up LND web client (lncli-web)

Open a new terminal window, clone the github repository, `cd` into it and install the required package dependencies.

```bash
# lncli-web terminal
# Clone the repo and cd into it:
git clone https://github.com/mably/lncli-web
cd lncli-web

# Install dependencies
npm install

# Setup default configuration files
"./node_modules/.bin/gulp" bundle
```

### Setting up certificates

The current NodeJS gRPC module implementation does not support P-521 kind of certificates, which are the ones auto-generated by lnd, you need to manually regenerate a compatible version of them (i.e. P-256) as follows:

```bash
# Enter the Lnd home directory, located by default at ~/.lnd on Linux or
# /Users/[username]/Library/Application Support/Lnd on Mac OSX

cd ~/.lnd
openssl ecparam -genkey -name prime256v1 -out tls.key
openssl req -new -sha256 -key tls.key -out csr.csr -subj '/CN=localhost/O=lnd'
openssl req -x509 -sha256 -days 3650 -key tls.key -in csr.csr -out tls.cert
rm csr.csr
```

Finally copy the generated certificate file into `lncli-web` directory:

```bash
cp tls.cert <lncli-web_directory>/lnd.cert

# go back to the lncli-web root directory
cd <lncli-web_directory>
```

### Running btcd

We'll launch `btcd` with the miner's address as the recipient of the generated blocks. Open a new terminal window and get the miner's address we generated in Stage 1 by submitting the following command:

```bash
# in a new terminal window
less $GOPATH/dev/miner/test_log/simnet/bitcoin/lnd.log | grep newaddress
2018-01-03 10:02:08.921 [INF] RPCS: [newaddress] addr=<MINER_ADDRESS>
```

Now run `btcd` as follows:

```bash
btcd --miningaddr=<MINER_ADDRESS>
```

### Running Alice, Bob and Charlie lnd nodes

Lunch the cluster of `lnd`s nodes for Alice, Bob and Charlie:

```bash
# from a new terminal window
cd $GOPATH/dev/alice
lnd --rpcport=10001 --peerport=10011 --restport=8001

# from a new terminal window
cd $GOPATH/dev/bob
lnd --rpcport=10002 --peerport=10012 --restport=8002

# from a new terminal window
cd $GOPATH/dev/charlie
```

### Running LND web client

We're now ready to play with the `lncli-web` app we already installed and set up at the very beginning of this Stage 2 tutorial. You can attach the web app to whichever `lnd` node you want. At the moment we're going to attach it to the Alice's `lnd` node.

```bash
# from the terminal where you installed lncli-web. Be sure to cd into the repository root directory
cd <lncli-web_directory>

# If you're curious, check out the available command line arguments
node server --help

# run the server by attaching it to Alice's node
node server --lndhost=localhost:10001
...
info:    App listening on localhost port 8280
```

As you see, the server inform you that the web app is listening on port 8280 of the localhost. Open up [`http://localhost:8280/`](http://localhost:8280/) in your browser to see the web dashboard.

### Poking around

Now it would be a good time to repeat the Stage 1 workflow, except this time we're going to do it through the web dashboard. In the `Node Info` panel of the `Node and Network Information` section, you should see that block height is 314, the number of blocks we previously generated in Stage 1. You should also see that there are no current active o pending channels. The `Network Info` panel inform you there are 3 connected nodes. The total network capacity is 0, because there are no active channels at the moment. In the `Wallet and Channel Balances` section you can see current Alice's balances, i.e. the wallet balance and the channel one. The latest is 0.

#### Alice's connections

In the `Peers` section you see that Alice is connected to one node (i.e. Bob's node).

#### Open a channel between Alice and Bob

To open a new channel with Bob click the `+` icon in the  'Active Channels' panel and select Bob's public-key from the drop-down menu of the `Node Pubkey` field. Type `1000000` in the `Local amount` field and `0` in the `Push amount` field. Then click the `Open Channel` button. You should now see that this channel is pending.

Open a new terminal window and generate 6 blocks to make the new channel confirmed.

```bash
# from a new terminal window
btcctl generate 6
```

You'll immediately see the change of the state of the channel from `pending` to `active`.

As you remember, this above is needed to create the on-chain funding transaction in the simnet blockchain. Note that Alice's local balance is `991,312`, because she had to pay a fee of `8,688` Satoshi to the miner of the blocks recording the opening of the channel.

#### Sending single hop payments

In the `Payments/Invoices` section you should still see Alice's payments from the previous Stage 1 tutorial.  As from the Stage 1 tutorial, let Bob create a payment request. You need to do this in a terminal window.

```bash
# from the same terminal window used to generate blocks
lncli-bob addinvoice --value=100000
{
	"r_hash": "b75e17df03eec97af0744329b653b841f830e4acd5b69413a6349e1cced5e35a",
	"pay_req": <PAYMENT_REQ>
}
```

Now copy the payment request code from the terminal, click the `+` icon from the `Payment` panel of the `Payments/Invoices` section of the dashboard and paste it into the `Payment request` field. You should immediately see the details of the payment request. Click the `Send Payment` button. The off-chain payment from Alice to Bob is almost instantaneous as you can verify by refreshing the `Active channels` panel. In the `Channel` panel you should also see the local and the remote balances being updated with the new values (i.e `891,312` and `100,000`).

#### Multi-hop payments

The running `lncli-web` app is attached to Alice's LND node and to setup multi-hop off-chain payments we need to use again the terminals.

##### Open a channel from Charlie to Bob

As we previously did in Stage 1 tutorial, Charlie has to open a single-funded payment channel with Bob.

```bash
# get Bob's public key
lncli-bob getinfo

# open the channel with Bob
lncli-charlie openchannel --node_key=02aaeeb6c7786d42b2d7f401003763868d1d1c0806bb19f3873cf793c46dbf71f2 --local_amt=800000 --push_amt=200000
{
	"funding_txid": "018074881921e71400d72cfeff2a92fdc6115d5d92d309fad11585299e144b5f"
}
```

As usual, this transaction has to be recorded and confirmed by the blockchain, so let's generate the required blocks.

```bash
btcctl generate 6
```

If you visit the dashboard, you should see the updated information in the `Network info` panel: there are now 2 channels and the total capacity of the channel network is `1800000` (i.e. the sum of the capacity of the two established channels).

##### Charlie adding invoice

Let's create an invoice by Charlie in such a way that Alice will be able to pay the generated payment request without being directly connected with Charlie.

```bash
lncli-charlie addinvoice --value=10000
{
	"r_hash": "798e7d42a93b9357b63e2949cf0dff1cae52992ee2b49506b56c4b886c49a750",
	"pay_req": <PAYMENT_REQ>
}
```
Copy the payment request identifier.

#### Alice paying Charlie

Go back to the dashboard and click the `+` from the `Payment` panel. Paste the copied payment request in the corresponding field. You should immediately see the payment detail, including Charlie's public-key as the destination of the payment. Click the `Send payment` button. You should now see an almost instant update of the `Payments` panel and if you refresh the `Active Channels` panel you should see the balances being updated as well:

* the value of the local balance is know `881310` (remote balance is `110001`).
* there is a new payment in the `Payment` panel.

### Other peers's view

As said, when we started the `lncli-web` app we attached it to Alice's LND node. But we could also attach it to Bob or Charlie's nodes.

Close the browser window, stop the running node server (CTRL-C/CMD-C) and rerun it by passing the LND address of Bob's node.

```bash
node server --lndhost=localhost:10001
...
info:    App listening on localhost port 8280
^C
# connect the node server to Bob's LND node
node server --lndhost=localhost:10002
...
info:    App listening on localhost port 8280
```

You now see the Bob's view of the network. Do the same with Charlie's view.

```bash
node server --lndhost=localhost:10002
...
info:    App listening on localhost port 8280
^C

# connect the node server to Charlie's LND node
node server --lndhost=localhost:10003
...
info:    App listening on localhost port 8280
```

### Conclusion

Feel free to try the dashboard on your own - the web dashboard is intuitive enough that we don't need step by step instructions for it.

When done, close the active channels, stop the node server, all the LND's nodes and finally the `btcd` daemon.

> NOTE: The LND wallet is coming soon! Sign up for our newsletter at the bottom
of our [community page](//lightning.community#mc-embedded-subscribe-form)

### Moving on to Step 3

By now, you should have gained familiarity with the web client.
In [Stage 3](/tutorial/03-rpc-client), we will learn how to set up a gRPC
client for programmatic access to our `lnd` nodes.

#### Navigation
- [Proceed to Stage 3 - RPC Client](/tutorial/03-rpc-client)
- [Return to Stage 1 - Setting up a local cluster](/tutorial/01-lncli)
- [Return to main tutorial page](/tutorial/)

### Questions
- Join the #dev-help channel on our [Community
  Slack](https://join.slack.com/t/lightningcommunity/shared_invite/MjI4OTg3MzQ4MjI2LTE1MDMxNzM1NTMtNjlmOGYzOTI1Ng)
- Join IRC:
  [![Irc](https://img.shields.io/badge/chat-on%20freenode-brightgreen.svg)](https://webchat.freenode.net/?channels=lnd)
